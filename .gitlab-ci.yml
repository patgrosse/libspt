image: rikorose/gcc-cmake
stages:
  - clean
  - build
  - test
  - docs
before_script:
  - "apt-get update -qq && apt-get install -y -qq libevent-dev"
makeclean:
  stage: clean
  script:
    - "cd examples"
    - "make clean"
makeLibevent:
  stage: build
  script:
    - "cd examples"
    - "make"
makeNoLibevent:
  stage: build
  script:
    - "cd examples"
    - "NO_LIBEVENT=1 make"
cmakeTests:
  stage: test
  script:
    - "git submodule sync --recursive"
    - "git submodule update --init --recursive"
    - "cd tests"
    - "mkdir build"
    - "cd build"
    - "cmake .."
    - "make"
    - "./runTests"
docs:
  image: iimuz/doxygen
  when: always
  script:
    - "doxygen Doxygen"
  artifacts:
    paths:
      - "build/doxygen"